syntax = "proto3";

package duologue.v1;

import "duologue/v1/common.proto";

option go_package = "github.com/june20516/duologue-server/gen/go/duologue/v1;duologuev1";

// ==========================================
// Auth Service
// ==========================================

service AuthService {
  // Signup
  rpc RequestSignup(RequestSignupRequest) returns (RequestSignupResponse);
  rpc VerifySignup(VerifySignupRequest) returns (VerifySignupResponse);

  // Login
  rpc RequestLogin(RequestLoginRequest) returns (RequestLoginResponse);
  rpc VerifyLogin(VerifyLoginRequest) returns (VerifyLoginResponse);

  // Token Management
  rpc RefreshAccessToken(RefreshAccessTokenRequest) returns (RefreshAccessTokenResponse);
  rpc Logout(LogoutRequest) returns (LogoutResponse);

  // User Info
  rpc GetMe(GetMeRequest) returns (GetMeResponse);

  // Account
  rpc DeleteAccount(DeleteAccountRequest) returns (DeleteAccountResponse);
}

// ==========================================
// Messages
// ==========================================

// --- Signup ---
message RequestSignupRequest {
  string email = 1;
}

message RequestSignupResponse {
  oneof result {
    RequestSignupSuccess success = 1;
    Error error = 2;
  }
}

message RequestSignupSuccess {
  string message = 1;
}

message VerifySignupRequest {
  string email = 1;
  string code = 2;
}

message VerifySignupResponse {
  oneof result {
    VerifySignupSuccess success = 1;
    Error error = 2;
  }
}

message VerifySignupSuccess {
  string access_token = 1;
  string refresh_token = 2;
  // User info can be added here if needed immediately after signup
}

// --- Login ---
message RequestLoginRequest {
  string email = 1;
}

message RequestLoginResponse {
  oneof result {
    RequestLoginSuccess success = 1;
    Error error = 2;
  }
}

message RequestLoginSuccess {
  string message = 1;
}

message VerifyLoginRequest {
  string email = 1;
  string code = 2;
}

message VerifyLoginResponse {
  oneof result {
    VerifyLoginSuccess success = 1;
    Error error = 2;
  }
}

message VerifyLoginSuccess {
  string access_token = 1;
  string refresh_token = 2;
}

// --- Token ---
message RefreshAccessTokenRequest {
  string refresh_token = 1;
}

message RefreshAccessTokenResponse {
  oneof result {
    RefreshAccessTokenSuccess success = 1;
    Error error = 2;
  }
}

message RefreshAccessTokenSuccess {
  string access_token = 1;
}

message LogoutRequest {
  string refresh_token = 1;
}

message LogoutResponse {
  oneof result {
    LogoutSuccess success = 1;
    Error error = 2;
  }
}

message LogoutSuccess {
  string message = 1;
}

// --- Me ---
message GetMeRequest {
  // Empty request, uses Authorization header
}

message GetMeResponse {
  oneof result {
    GetMeSuccess success = 1;
    Error error = 2;
  }
}

message GetMeSuccess {
  int64 user_id = 1;
  string email = 2;
  // Add other basic user info as needed
}

// --- Account ---
message DeleteAccountRequest {}

message DeleteAccountResponse {
  oneof result {
    DeleteAccountSuccess success = 1;
    Error error = 2;
  }
}

message DeleteAccountSuccess {
  string message = 1;
}

